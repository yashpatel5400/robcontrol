# robcontrol

Conformal robust LQR utilities built to complement the `robbuffet` toolbox.

## Install
- Requires Python >= 3.10.
- From repo root:
  ```bash
  pip install -e .
  ```
- Key dependency: `robbuffet` (for conformal calibration + operator-norm score).

## What it does
- Provides controller synthesis utilities: CPC robust controller, optional H-infinity baseline, Riccati/rollout helpers.
- Example pipeline (in `examples/`) to generate synthetic LQR datasets, train a dynamics predictor, conformalize with operator-norm scores, and compare nominal vs CPC on predicted dynamics.

## Quickstart
### Use the package (CPC controller)
```python
import numpy as np
from robcontrol import CPCController, solve_discrete_lqr

A = np.array([[0., 1.], [-10., -1.]])
B = np.array([[0.], [1.]])
Q = np.diag([10.0, 1.0])
R = np.array([[0.1]])

K_nom = solve_discrete_lqr(A, B, Q, R)
cpc = CPCController(Q, R)
K_cpc = cpc.synthesize(A, B)
```

### Run the full pipeline (examples)
```bash
python -m examples.data --task cartpole --num-samples 500 --horizon 200 --seed 0 --out artifacts/cartpole_dataset.npz
python -m examples.model --dataset artifacts/cartpole_dataset.npz --out-model artifacts/cartpole_model.pt --out-meta artifacts/cartpole_meta.json --epochs 400 --lr 1e-3 --batch-size 128
python -m examples.assess --dataset artifacts/cartpole_dataset.npz --model artifacts/cartpole_model.pt --meta artifacts/cartpole_meta.json --horizon 200 --rollouts 5 --trials 5 --seed 0
```
Outputs: calibration plot and metrics JSON (means/stds; paired t-test robust < nominal when trials > 1).

## Sample results
Cartpole (500 samples, horizon 200, rollouts 5, trials 5):
| method                | mean cost | std    |
|-----------------------|-----------|--------|
| true_opt_on_true      | 132.28    | 9.10   |
| nominal_on_true       | 3353.10   | 456.71 |
| cpc_on_true           | 3353.08   | 456.70 |
| t-test (robust < nom) | t = -4.18 | p=0.007 |

Mass-spring-damper (500 samples, horizon 200, rollouts 5, trials 5):
| method                | mean cost | std   |
|-----------------------|-----------|-------|
| true_opt_on_true      | 5.97      | 0.48  |
| nominal_on_true       | 8.98      | 0.81  |
| cpc_on_true           | 8.98      | 0.81  |
| t-test (robust < nom) | t = -14.22| p=7.1e-05 |

## Package layout
- `robcontrol/`: package code (controllers, Riccati/rollout utilities).
- `examples/`: data generation, model training, and assessment scripts using the package.
- `artifacts/`: sample datasets, models, and metrics generated by the examples.

## Citation
If you use this in academic work, please also cite the underlying conformal robust control paper:
```
@article{patel2024conformal,
  title={Conformal robust control of linear systems},
  author={Patel, Yash and Rayan, Sahana and Tewari, Ambuj},
  journal={arXiv preprint arXiv:2405.16250},
  year={2024}
}
```
